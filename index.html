<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Flamey â€“ Wrights Heating & Gas</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <style>
    :root {
      --pink: #e91e93;
      --deep-purple: #5a2d82;
      --light-pink: #ff1493;
    }
    
    * { box-sizing: border-box; }
    
    body { 
      margin:0; 
      font-family: system-ui, sans-serif; 
      background:#f8f9fa; 
    }
    
    #chat-container {
      position: fixed;
      bottom: 20px;
      right: 20px;
      width: 400px;
      height: 650px;
      background: transparent;
      border-radius: 24px;
      box-shadow: none;
      border: none;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      z-index: 9999;
      animation: slideUp 0.3s ease-out;
    }
    
    #open-btn {
      display: none;
    }
    
    @keyframes slideUp {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    #header {
      background: linear-gradient(135deg, var(--pink), var(--light-pink), var(--deep-purple));
      color: white;
      padding: 16px;
      display: flex;
      align-items: center;
      gap: 12px;
      position: relative;
    }
    
    #header h2 { margin:0; font-size: 1.4rem; position: relative; z-index: 1; }
    #header p { margin:0; font-size: 0.9rem; opacity: 0.9; position: relative; z-index: 1; }
    
    #messages {
      flex: 1;
      padding: 16px;
      overflow-y: auto;
      background: transparent;
    }
    
    #messages::-webkit-scrollbar { width: 6px; }
    #messages::-webkit-scrollbar-track { background: #f1f1f1; }
    #messages::-webkit-scrollbar-thumb { background: var(--pink); border-radius: 3px; }
    
    .msg {
      margin-bottom: 12px;
      max-width: 85%;
      line-height: 1.5;
      font-size: 15px;
      animation: fadeIn 0.3s ease-out;
    }
    
    .bot {
      display: flex;
      align-items: flex-start;
      gap: 10px;
    }
    
    .bot-bubble {
      background: linear-gradient(to bottom right, #fffaf5, #ffffff);
      border: 2px solid var(--pink);
      border-radius: 20px;
      border-top-left-radius: 4px;
      padding: 14px 18px;
      color: #333;
    }
    
    .bot-bubble strong {
      color: var(--deep-purple);
      display: block;
      margin-bottom: 6px;
    }
    
    .bot-bubble ul {
      margin: 8px 0;
      padding-left: 20px;
    }
    
    .bot-bubble li {
      margin: 4px 0;
    }
    
    .price-box {
      background: linear-gradient(135deg, #fff4f9, #f8f9fa);
      border: 2px solid var(--pink);
      border-radius: 12px;
      padding: 12px 16px;
      margin: 10px 0;
      font-weight: 600;
      color: var(--deep-purple);
    }
    
    .price-box .price {
      font-size: 1.4rem;
      color: var(--pink);
      display: block;
      margin: 4px 0;
    }
    
    .info-box {
      background: #e8f4f8;
      border-left: 4px solid #17a2b8;
      padding: 12px;
      margin: 10px 0;
      border-radius: 4px;
      font-size: 0.9rem;
    }
    
    .user {
      margin-left: auto;
      background: var(--deep-purple);
      color: white;
      border-radius: 20px;
      border-top-right-radius: 4px;
      padding: 12px 16px;
      text-align: right;
    }
    
    .typing-indicator {
      display: flex;
      gap: 4px;
      padding: 12px 16px;
    }
    
    .typing-indicator span {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: var(--pink);
      animation: typing 1.4s infinite;
    }
    
    .typing-indicator span:nth-child(2) { animation-delay: 0.2s; }
    .typing-indicator span:nth-child(3) { animation-delay: 0.4s; }
    
    @keyframes typing {
      0%, 60%, 100% { transform: translateY(0); opacity: 0.5; }
      30% { transform: translateY(-10px); opacity: 1; }
    }
    
    #quick {
      padding: 12px 16px;
      border-top: 1px solid rgba(238, 238, 238, 0.5);
      background: transparent;
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      max-height: 200px;
      overflow-y: auto;
    }
    
    .quick-btn {
      font-size: 0.82rem;
      padding: 8px 16px;
      border-radius: 999px;
      background: #ffe4f0;
      color: var(--pink);
      border: none;
      cursor: pointer;
      transition: all 0.2s;
      font-weight: 500;
    }
    
    .quick-btn:hover { 
      background: var(--pink);
      color: white;
      transform: translateY(-2px);
    }
    
    #input-area {
      padding: 16px;
      border-top: 1px solid rgba(238, 238, 238, 0.5);
      background: transparent;
      display: flex;
      gap: 10px;
    }
    
    #user-input {
      flex: 1;
      padding: 12px 18px;
      border: 2px solid #ddd;
      border-radius: 999px;
      font-size: 1rem;
      outline: none;
      transition: border-color 0.2s;
    }
    
    #user-input:focus { 
      border-color: var(--pink);
      box-shadow: 0 0 0 3px rgba(233,30,147,0.1);
    }
    
    #send-btn {
      width: 52px;
      height: 52px;
      background: linear-gradient(135deg, var(--pink), var(--light-pink));
      color: white;
      border: none;
      border-radius: 50%;
      font-size: 1.3rem;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    #send-btn:hover {
      transform: scale(1.1);
      box-shadow: 0 4px 12px rgba(233,30,147,0.4);
    }
    
    #send-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    
    #open-btn {
      position: fixed;
      bottom: 20px;
      right: 20px;
      width: 70px;
      height: 70px;
      background: linear-gradient(135deg, var(--pink), var(--light-pink), var(--deep-purple));
      color: white;
      border: none;
      border-radius: 50%;
      box-shadow: 0 6px 20px rgba(233,30,147,0.4);
      cursor: pointer;
      z-index: 9999;
      animation: pulse 2s infinite;
      padding: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    #btn-flamey {
      width: 100%;
      height: 100%;
      animation: bounce 2s ease-in-out infinite;
    }
    
    #btn-flamey svg {
      width: 100%;
      height: 100%;
    }
    
    @keyframes bounce {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-5px); }
    }
    
    .avatar { 
      width: 52px; 
      height: 52px; 
      flex-shrink: 0;
    }
    
    .avatar svg { width: 100%; height: 100%; }
    
    .action-buttons {
      display: flex;
      gap: 8px;
      margin-top: 12px;
      flex-wrap: wrap;
    }
    
    .action-btn {
      padding: 8px 16px;
      border-radius: 20px;
      border: 2px solid var(--pink);
      background: white;
      color: var(--pink);
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      font-size: 0.85rem;
    }
    
    .action-btn:hover {
      background: var(--pink);
      color: white;
    }
    
    .contact-form {
      background: #f8f9fa;
      padding: 16px;
      border-radius: 12px;
      margin-top: 8px;
    }
    
    .form-group {
      margin-bottom: 12px;
    }
    
    .form-group label {
      display: block;
      font-size: 0.85rem;
      font-weight: 600;
      color: var(--deep-purple);
      margin-bottom: 4px;
    }
    
    .form-group input,
    .form-group textarea {
      width: 100%;
      padding: 10px 14px;
      border: 2px solid #ddd;
      border-radius: 8px;
      font-size: 0.95rem;
      font-family: inherit;
    }
    
    .form-group input:focus,
    .form-group textarea:focus {
      outline: none;
      border-color: var(--pink);
    }
    
    .submit-btn {
      width: 100%;
      padding: 12px;
      background: linear-gradient(135deg, var(--pink), var(--light-pink));
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
    }
    
    @media (max-width: 480px) {
      #chat-container {
        width: calc(100vw - 20px);
        height: calc(100vh - 90px);
        right: 10px;
        bottom: 80px;
      }
    }
  </style>
</head>
<body>

<button id="open-btn">
  <div id="btn-flamey"></div>
</button>

<div id="chat-container">
  <div id="header">
    <div class="avatar" id="flamey-avatar"></div>
    <div>
      <h2>Hi! I'm Flamey</h2>
      <p>Wrights Heating & Gas</p>
    </div>
  </div>

  <div id="messages"></div>

  <div id="quick">
    <button class="quick-btn" onclick="quick('prices')"><i class="fas fa-pound-sign"></i> Prices</button>
    <button class="quick-btn" onclick="quick('boiler-service')"><i class="fas fa-tools"></i> Boiler Service</button>
    <button class="quick-btn" onclick="quick('installation')"><i class="fas fa-wrench"></i> Installation</button>
    <button class="quick-btn" onclick="quick('areas')"><i class="fas fa-map-marker-alt"></i> Coverage</button>
    <button class="quick-btn" onclick="quick('water-softener')"><i class="fas fa-tint"></i> Water Softener</button>
    <button class="quick-btn" onclick="quick('repairs')"><i class="fas fa-screwdriver"></i> Repairs</button>
  </div>

  <div id="input-area">
    <input id="user-input" type="text" placeholder="Ask me anythingâ€¦" autocomplete="off"/>
    <button id="send-btn"><i class="fas fa-paper-plane"></i></button>
  </div>
</div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// FLAMEY MASCOT SVG
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const flamey = `<svg viewBox="0 0 400 500" xmlns="http://www.w3.org/2000/svg">
    <ellipse cx="200" cy="480" rx="80" ry="15" fill="rgba(0,0,0,0.1)"/>
    <path d="M 200 450 Q 160 440 150 400 Q 140 360 145 320 Q 150 280 160 250 Q 170 220 180 200 Q 185 180 190 160 Q 195 140 200 120 Q 205 140 210 160 Q 215 180 220 200 Q 230 220 240 250 Q 250 280 255 320 Q 260 360 250 400 Q 240 440 200 450 Z" fill="url(#flameGradient)"/>
    <path d="M 170 350 Q 150 340 140 310 Q 135 290 140 270 Q 145 250 155 235 Q 165 220 170 210 Q 175 200 178 185 Q 180 200 182 215 Q 185 230 190 250 Q 192 270 190 290 Q 188 310 180 330 Q 175 345 170 350 Z" fill="url(#accentGradient1)"/>
    <path d="M 230 350 Q 250 340 260 310 Q 265 290 260 270 Q 255 250 245 235 Q 235 220 230 210 Q 225 200 222 185 Q 220 200 218 215 Q 215 230 210 250 Q 208 270 210 290 Q 212 310 220 330 Q 225 345 230 350 Z" fill="url(#accentGradient2)"/>
    <circle cx="200" cy="280" r="65" fill="#ffffff"/>
    <circle cx="200" cy="280" r="63" fill="#fef9f3"/>
    <g id="eyes">
        <ellipse cx="185" cy="270" rx="12" ry="18" fill="#5a2d82"/>
        <ellipse cx="187" cy="268" rx="5" ry="7" fill="#ffffff"/>
        <circle cx="189" cy="272" r="2" fill="#ffffff"/>
        <ellipse cx="215" cy="270" rx="12" ry="18" fill="#5a2d82"/>
        <ellipse cx="217" cy="268" rx="5" ry="7" fill="#ffffff"/>
        <circle cx="219" cy="272" r="2" fill="#ffffff"/>
    </g>
    <path d="M 180 295 Q 200 310 220 295" stroke="#5a2d82" stroke-width="4" fill="none" stroke-linecap="round"/>
    <ellipse cx="165" cy="285" rx="10" ry="7" fill="#ff9bb3" opacity="0.5"/>
    <ellipse cx="235" cy="285" rx="10" ry="7" fill="#ff9bb3" opacity="0.5"/>
    <rect x="155" y="330" width="90" height="15" rx="3" fill="#5a2d82"/>
    <rect x="157" y="332" width="86" height="11" rx="2" fill="#764ba2"/>
    <g transform="translate(175, 337)">
        <rect x="0" y="0" width="4" height="12" fill="#e91e93" rx="1"/>
        <circle cx="2" cy="2" r="3" fill="none" stroke="#e91e93" stroke-width="1.5"/>
    </g>
    <g transform="translate(195, 335)">
        <rect x="0" y="0" width="3" height="14" fill="#ff1493"/>
        <rect x="0" y="0" width="3" height="2" fill="#ff69b4"/>
    </g>
    <g id="leftArm">
        <ellipse cx="140" cy="300" rx="18" ry="28" fill="url(#armGradient)" transform="rotate(-20 140 300)"/>
        <ellipse cx="132" cy="275" rx="8" ry="12" fill="url(#armGradient)" transform="rotate(-30 132 275)"/>
    </g>
    <g id="rightArm">
        <ellipse cx="260" cy="300" rx="18" ry="28" fill="url(#armGradient)" transform="rotate(20 260 300)"/>
        <g transform="translate(265, 285) rotate(30)">
            <rect x="0" y="0" width="6" height="40" fill="#cccccc" rx="2"/>
            <circle cx="3" cy="3" r="8" fill="none" stroke="#cccccc" stroke-width="3"/>
            <circle cx="3" cy="37" r="5" fill="#999999"/>
        </g>
    </g>
    <g opacity="0.8">
        <path d="M 280 200 L 282 208 L 290 210 L 282 212 L 280 220 L 278 212 L 270 210 L 278 208 Z" fill="#e91e93"/>
        <path d="M 120 240 L 122 246 L 128 248 L 122 250 L 120 256 L 118 250 L 112 248 L 118 246 Z" fill="#ff1493"/>
        <path d="M 300 320 L 301 324 L 305 325 L 301 326 L 300 330 L 299 326 L 295 325 L 299 324 Z" fill="#e91e93"/>
    </g>
    <defs>
        <linearGradient id="flameGradient" x1="0%" y1="0%" x2="0%" y2="100%">
            <stop offset="0%" style="stop-color:#e91e93;stop-opacity:1" />
            <stop offset="50%" style="stop-color:#ff1493;stop-opacity:1" />
            <stop offset="100%" style="stop-color:#5a2d82;stop-opacity:1" />
        </linearGradient>
        <linearGradient id="accentGradient1" x1="0%" y1="0%" x2="100%" y2="100%">
            <stop offset="0%" style="stop-color:#5a2d82;stop-opacity:1" />
            <stop offset="100%" style="stop-color:#764ba2;stop-opacity:1" />
        </linearGradient>
        <linearGradient id="accentGradient2" x1="100%" y1="0%" x2="0%" y2="100%">
            <stop offset="0%" style="stop-color:#ff1493;stop-opacity:1" />
            <stop offset="100%" style="stop-color:#e91e93;stop-opacity:1" />
        </linearGradient>
        <linearGradient id="armGradient" x1="0%" y1="0%" x2="100%" y2="100%">
            <stop offset="0%" style="stop-color:#ff1493;stop-opacity:1" />
            <stop offset="100%" style="stop-color:#e91e93;stop-opacity:1" />
        </linearGradient>
    </defs>
</svg>`;

document.getElementById('flamey-avatar').innerHTML = flamey;
document.getElementById('btn-flamey').innerHTML = flamey;

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// COMPREHENSIVE KNOWLEDGE BASE - Scraped from www.wrightsgas.co.uk
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const knowledgeBase = {
  company: {
    name: "Wrights Heating & Gas Services Ltd",
    phone: ["01920 468674", "07971252440"],
    experience: "19 years",
    rating: "5 Star Google reviews",
    gasRafeNumber: "529065",
    vatNumber: "387001700",
    qualifications: ["Fully qualified", "Gas Safe Registered", "Fully insured"],
    website: "www.wrightsgas.co.uk"
  },
  
  pricing: {
    boilerService: {
      typical: "Â£100-Â£120",
      detailed: "UK average is Â£80-Â£120. Our prices are competitive and we provide transparent quotes.",
      includes: [
        "Visual inspection of boiler and components",
        "Safety checks including gas pressure and carbon monoxide",
        "Cleaning of key components",
        "Performance testing",
        "Gas Safe certification"
      ],
      note: "Annual service recommended to maintain warranty and safety"
    },
    landlordCertificate: {
      service: "Gas Safety Certificates",
      requirement: "Required every 12 months by law",
      includes: ["All gas appliance checks", "Safety certification", "Full compliance documentation"]
    }
  },
  
  services: {
    boilerInstallation: {
      name: "Boiler Installation & Replacements",
      description: "New boiler installations and complete boiler replacements for domestic and commercial properties",
      benefits: [
        "Energy efficient modern boilers",
        "Reduced heating bills",
        "Expert installation by Gas Safe engineers",
        "Competitive pricing with transparent quotes"
      ],
      brands: ["Worcester Bosch", "Vaillant", "Ideal", "Baxi"],
      keywords: ["new boiler", "boiler replacement", "install boiler", "boiler upgrade"]
    },
    
    boilerRepairs: {
      name: "Boiler & Heating Repairs",
      description: "Expert repair services for all boiler makes and models",
      services: [
        "Radiator replacements and relocations",
        "Valve replacements",
        "Faulty controls repair",
        "Smart thermostats installation",
        "Powerflushing",
        "Pipework repairs",
        "Pump replacements",
        "System chemical checks"
      ],
      keywords: ["broken boiler", "boiler repair", "heating not working", "radiator", "leak"]
    },
    
    applianceServices: {
      name: "Appliance Installation & Repairs",
      services: [
        "Cooker installation, service and repair",
        "Fire service and repair",
        "Gas hob installation, service and repair",
        "Underground pipework and fusion welding",
        "Unvented and vented hot water cylinder installation, service and repair"
      ],
      keywords: ["cooker", "hob", "fire", "hot water cylinder", "appliance"]
    },
    
    lpgServices: {
      name: "LPG Installations & Repairs",
      description: "Comprehensive LPG gas services for properties not connected to mains gas",
      keywords: ["lpg", "propane", "bottled gas", "tank"]
    },
    
    plumbingBathrooms: {
      name: "Plumbing Repairs & Bathrooms",
      description: "Full plumbing and bathroom services",
      keywords: ["plumbing", "bathroom", "tap", "shower", "toilet", "leak"]
    },
    
    waterSofteners: {
      name: "Water Softener Installation",
      description: "Our area has incredibly hard water. A water softener offers many advantages:",
      benefits: [
        "Reduces maintenance on sanitary ware, showers and taps",
        "Protects white goods from limescale",
        "Reduces limescale buildup in hot water cylinders",
        "Improves efficiency and reduces running costs",
        "Softer skin and hair",
        "Less cleaning required"
      ],
      recommendation: "Highly recommended for this area due to hard water",
      keywords: ["water softener", "hard water", "limescale", "scale"]
    }
  },
  
  coverage: {
    main: ["Hertfordshire", "North London"],
    specific: ["Ware", "Hertford", "Hoddesdon", "Broxbourne", "Welwyn Garden City", "Harlow", "Stevenage", "Bishops Stortford", "Potters Bar"],
    surrounding: "and surrounding areas",
    keywords: ["area", "cover", "location", "where", "serve"]
  },
  
  emergency: {
    available: false,
    response: "We can arrange appointments as soon as possible. For gas emergencies, call National Gas Emergency Service on 0800 111 999",
    contact: "Call us on 01920 468674 or 07971252440 to discuss urgent appointments",
    keywords: ["emergency", "urgent", "broken", "no heating", "leak", "asap", "now"]
  },
  
  gasSafety: {
    registered: true,
    number: "529065",
    info: "Gas Safe Register is the official list of gas engineers qualified to work safely and legally on gas appliances. By law, all gas engineers must be on the Gas Safe Register.",
    landlordDuties: "Landlords must have all gas appliances checked every 12 months by a Gas Safe registered engineer",
    warning: "Badly fitted and poorly serviced appliances can cause gas leaks, fires, explosions and carbon monoxide poisoning"
  }
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// AI-POWERED INTENT RECOGNITION WITH HELP-FIRST MENTALITY
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function analyzeIntent(userMessage) {
  const msg = userMessage.toLowerCase();
  
  // PRICE INQUIRIES - Priority for help-first mentality
  if (/(how much|price|cost|charge|fee|pricing|quote)/.test(msg)) {
    if (/(boiler service|service boiler|annual service)/.test(msg)) {
      return { intent: 'price_boiler_service', confidence: 0.95 };
    }
    if (/(new boiler|boiler install|replacement)/.test(msg)) {
      return { intent: 'price_installation', confidence: 0.95 };
    }
    if (/(repair|fix)/.test(msg)) {
      return { intent: 'price_repair', confidence: 0.9 };
    }
    if (/(landlord|certificate|gas safe|cp12)/.test(msg)) {
      return { intent: 'price_landlord_cert', confidence: 0.95 };
    }
    return { intent: 'pricing_general', confidence: 0.85 };
  }
  
  // URGENT ISSUES - Redirect to booking (no emergency service)
  if (/(emergency|urgent|asap|right now|immediately|broken|not working|no heating|no hot water|leak|flooding|gas smell)/.test(msg)) {
    return { intent: 'urgent_booking', confidence: 0.98, urgent: true };
  }
  
  // GREETING
  if (/^(hi|hello|hey|good morning|good afternoon|good evening|hiya)/.test(msg)) {
    return { intent: 'greeting', confidence: 0.9 };
  }
  
  // SERVICE-SPECIFIC INQUIRIES
  if (/(boiler service|annual service|service boiler|boiler check)/.test(msg)) {
    return { intent: 'boiler_service_info', confidence: 0.9 };
  }
  
  if (/(water softener|hard water|limescale|scale)/.test(msg)) {
    return { intent: 'water_softener', confidence: 0.9 };
  }
  
  if (/(new boiler|boiler install|replacement|upgrade)/.test(msg)) {
    return { intent: 'installation', confidence: 0.9 };
  }
  
  if (/(repair|fix|broken|fault)/.test(msg)) {
    return { intent: 'repairs', confidence: 0.85 };
  }
  
  if (/(landlord|certificate|cp12|gas safe check|letting)/.test(msg)) {
    return { intent: 'landlord_cert', confidence: 0.9 };
  }
  
  // LOCATION/COVERAGE
  if (/(area|cover|location|where|region|do you serve|come to)/.test(msg)) {
    return { intent: 'coverage', confidence: 0.85 };
  }
  
  // BOOKING/CONTACT
  if (/(book|appointment|visit|arrange|schedule|come out)/.test(msg)) {
    return { intent: 'booking', confidence: 0.9 };
  }
  
  return { intent: 'general_help', confidence: 0.6 };
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// INTELLIGENT RESPONSE GENERATION - HELP-FIRST APPROACH
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function generateResponse(intent, userMessage) {
  switch(intent.intent) {
    case 'greeting':
      return `Hello! ğŸ‘‹ I'm Flamey from ${knowledgeBase.company.name}.\n\nWe've been serving ${knowledgeBase.company.experience} with ${knowledgeBase.company.rating}!\n\n<strong>I'm here to help you with:</strong>\nâ€¢ Pricing information\nâ€¢ Boiler services & repairs\nâ€¢ New installations\nâ€¢ Water softeners\nâ€¢ Landlord certificates\nâ€¢ Any heating or gas questions\n\n<strong>What can I help you with today?</strong>`;
    
    case 'urgent_booking':
      return `<strong>ğŸ”§ Urgent Assistance Needed</strong>\n\nI understand you need help quickly! While we don't offer emergency call-outs, we can arrange an appointment as soon as possible.\n\n<div class="info-box">âš ï¸ <strong>If you smell gas:</strong> Call the National Gas Emergency Service immediately on <strong>0800 111 999</strong></div>\n\n<div class="price-box">ğŸ“ Call us to discuss urgent appointments:<br><strong>01920 468674</strong> or <strong>07971252440</strong></div>\n\nOr fill in the form below and we'll contact you right away:` +
      generateActionButtons(['book_repair', 'call_now']);
    
    case 'price_boiler_service':
      return `<strong>ğŸ’° Boiler Service Pricing</strong>\n\n<div class="price-box">Typical Cost<span class="price">${knowledgeBase.pricing.boilerService.typical}</span>UK average price range</div>\n\n<strong>What's Included:</strong>\n${knowledgeBase.pricing.boilerService.includes.map(item => `âœ“ ${item}`).join('\n')}\n\n<div class="info-box">ğŸ’¡ <strong>Good to know:</strong> Annual servicing is recommended to maintain your warranty and ensure safe operation. We provide Gas Safe certification with every service.</div>\n\n<strong>Would you like to:</strong>` +
      generateActionButtons(['book_service', 'more_services']);
    
    case 'price_installation':
      return `<strong>ğŸ’° New Boiler Installation Pricing</strong>\n\nBoiler installation costs vary based on:\nâ€¢ Boiler type (combi, system, regular)\nâ€¢ Boiler size and brand\nâ€¢ Complexity of installation\nâ€¢ Any additional work needed\n\n<strong>Why choose us:</strong>\nâœ“ ${knowledgeBase.company.experience} experience\nâœ“ Gas Safe registered engineers\nâœ“ Competitive transparent pricing\nâœ“ Quality brands: ${knowledgeBase.services.boilerInstallation.brands.join(', ')}\n\n<div class="info-box">ğŸ’¡ Modern boilers can save you money on heating bills through improved efficiency!</div>\n\n<strong>I'd love to arrange a free, no-obligation quote for you:</strong>` +
      generateActionButtons(['book_quote', 'call_now']);
    
    case 'price_repair':
      return `<strong>ğŸ’° Boiler Repair Pricing</strong>\n\nRepair costs depend on:\nâ€¢ The specific issue\nâ€¢ Parts required\nâ€¢ Labour time\n\nWe provide honest, transparent pricing before starting any work.\n\n<strong>Common repairs we handle:</strong>\n${knowledgeBase.services.boilerRepairs.services.slice(0, 6).map(s => `â€¢ ${s}`).join('\n')}\n\n<div class="info-box">âš¡ Fast turnaround on parts ordering - we work with all major brands</div>\n\n<strong>Let's get your heating sorted:</strong>` +
      generateActionButtons(['book_repair', 'emergency_call']);
    
    case 'price_landlord_cert':
      return `<strong>ğŸ’° Landlord Gas Safety Certificates</strong>\n\n${knowledgeBase.pricing.landlordCertificate.requirement}\n\n<strong>What's included:</strong>\n${knowledgeBase.pricing.landlordCertificate.includes.map(i => `âœ“ ${i}`).join('\n')}\n\n<div class="info-box">âš–ï¸ <strong>Legal Requirement:</strong> Landlords must have all gas appliances checked every 12 months by a Gas Safe registered engineer (No. ${knowledgeBase.gasSafety.number})</div>\n\n<strong>Ready to book your inspection?</strong>` +
      generateActionButtons(['book_cert', 'call_now']);
    
    case 'pricing_general':
      return `<strong>ğŸ’° Our Pricing</strong>\n\nWe believe in transparent, competitive pricing. Every job is different, so costs vary based on your specific needs.\n\n<strong>Quick price guide:</strong>\nâ€¢ Boiler Service: ${knowledgeBase.pricing.boilerService.typical}\nâ€¢ New Boiler Installation: Free quote required\nâ€¢ Repairs: Depends on issue & parts\nâ€¢ Landlord Certificates: Competitive rates\n\n<strong>What makes us great value:</strong>\nâœ“ ${knowledgeBase.company.experience} experience\nâœ“ No hidden fees\nâœ“ Quality workmanship guaranteed\nâœ“ ${knowledgeBase.company.rating}\n\n<strong>What service are you interested in?</strong>` +
      generateActionButtons(['boiler_service', 'installation', 'repairs', 'get_quote']);
    
    case 'boiler_service_info':
      return `<strong>ğŸ”§ Annual Boiler Service</strong>\n\n${knowledgeBase.pricing.boilerService.detailed}\n\n<strong>Why service your boiler annually?</strong>\nâ€¢ Maintains efficiency & saves money\nâ€¢ Keeps warranty valid\nâ€¢ Prevents breakdowns\nâ€¢ Ensures safety\nâ€¢ Gas Safe certification\n\n<strong>What we check:</strong>\n${knowledgeBase.pricing.boilerService.includes.map(i => `âœ“ ${i}`).join('\n')}\n\n<div class="price-box">Price Range<span class="price">${knowledgeBase.pricing.boilerService.typical}</span></div>` +
      generateActionButtons(['book_service', 'call_now']);
    
    case 'water_softener':
      return `<strong>ğŸ’§ Water Softener Installation</strong>\n\n${knowledgeBase.services.waterSofteners.description}\n\n<strong>Benefits:</strong>\n${knowledgeBase.services.waterSofteners.benefits.map(b => `âœ“ ${b}`).join('\n')}\n\n<div class="info-box">ğŸŒŠ <strong>${knowledgeBase.services.waterSofteners.recommendation}</strong></div>\n\n<strong>Interested in finding out more?</strong>` +
      generateActionButtons(['book_quote', 'call_now']);
    
    case 'installation':
      return `<strong>ğŸ”¥ Boiler Installation & Replacements</strong>\n\n${knowledgeBase.services.boilerInstallation.description}\n\n<strong>Benefits of a new boiler:</strong>\n${knowledgeBase.services.boilerInstallation.benefits.map(b => `âœ“ ${b}`).join('\n')}\n\n<strong>Brands we install:</strong>\n${knowledgeBase.services.boilerInstallation.brands.join(' â€¢ ')}\n\n<div class="info-box">ğŸ’¡ Modern boilers can be up to 90% efficient, significantly reducing your energy bills!</div>` +
      generateActionButtons(['book_quote', 'call_now']);
    
    case 'repairs':
      return `<strong>ğŸ”§ Boiler & Heating Repairs</strong>\n\nWe repair all makes and models of boilers.\n\n<strong>Services we offer:</strong>\n${knowledgeBase.services.boilerRepairs.services.map(s => `â€¢ ${s}`).join('\n')}\n\n<div class="info-box">âš¡ Fast service with quick parts ordering from all major brands</div>\n\n<strong>Need a repair?</strong>` +
      generateActionButtons(['book_repair', 'emergency_call']);
    
    case 'landlord_cert':
      return `<strong>ğŸ“‹ Landlord Gas Safety Certificates</strong>\n\n${knowledgeBase.pricing.landlordCertificate.requirement}\n\n<strong>Included:</strong>\n${knowledgeBase.pricing.landlordCertificate.includes.map(i => `âœ“ ${i}`).join('\n')}\n\n<div class="info-box">âš–ï¸ <strong>Your Legal Responsibility:</strong><br>${knowledgeBase.gasSafety.landlordDuties}</div>\n\n<strong>We're Gas Safe Registered (No. ${knowledgeBase.gasSafety.number})</strong>` +
      generateActionButtons(['book_cert', 'call_now']);
    
    case 'coverage':
      return `<strong>ğŸ“ Areas We Cover</strong>\n\nWe serve ${knowledgeBase.coverage.main.join(' and ')} ${knowledgeBase.coverage.surrounding}.\n\n<strong>Including:</strong>\n${knowledgeBase.coverage.specific.join(' â€¢ ')}\n\n<div class="info-box">ğŸ“ Not sure if we cover your area? Give us a call on <strong>01920 468674</strong> and we'll let you know!</div>\n\n<strong>What can I help you with?</strong>` +
      generateActionButtons(['book_service', 'get_quote']);
    
    case 'booking':
      return showContactForm();
    
    default:
      return `I'm here to help! ğŸ˜Š\n\n<strong>I can assist you with:</strong>\nâ€¢ Pricing for services\nâ€¢ Boiler servicing & repairs\nâ€¢ New boiler installations\nâ€¢ Landlord certificates\nâ€¢ Water softeners\nâ€¢ Coverage areas\n\n<strong>What would you like to know about?</strong>` +
      generateActionButtons(['prices', 'book_service', 'call_now']);
  }
}

function generateActionButtons(actions) {
  const buttonMap = {
    book_service: '<button class="action-btn" onclick="showBookingForm(\'service\')">ğŸ“… Book a Service</button>',
    book_quote: '<button class="action-btn" onclick="showBookingForm(\'quote\')">ğŸ“‹ Get a Quote</button>',
    book_repair: '<button class="action-btn" onclick="showBookingForm(\'repair\')">ğŸ”§ Book a Repair</button>',
    book_cert: '<button class="action-btn" onclick="showBookingForm(\'certificate\')">ğŸ“‹ Book Certificate</button>',
    call_now: '<button class="action-btn" onclick="quickCall()">ğŸ“ Call Now</button>',
    more_services: '<button class="action-btn" onclick="quick(\'services\')">ğŸ” See All Services</button>',
    boiler_service: '<button class="action-btn" onclick="quick(\'boiler-service\')">ğŸ”§ Boiler Service</button>',
    installation: '<button class="action-btn" onclick="quick(\'installation\')">ğŸ”¥ Installation</button>',
    repairs: '<button class="action-btn" onclick="quick(\'repairs\')">ğŸ› ï¸ Repairs</button>',
    get_quote: '<button class="action-btn" onclick="showBookingForm(\'quote\')">ğŸ“ Get Quote</button>',
    prices: '<button class="action-btn" onclick="quick(\'prices\')">ğŸ’° View Prices</button>'
  };
  
  return '<div class="action-buttons">' + 
    actions.map(a => buttonMap[a] || '').join('') + 
    '</div>';
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CONTACT FORM
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function showContactForm() {
  return `<div class="contact-form">
    <strong>ğŸ“… Let's Get You Booked In!</strong>
    <p style="font-size:0.9rem;margin:8px 0 16px 0;">Fill in your details and we'll be in touch shortly:</p>
    
    <div class="form-group">
      <label>Full Name *</label>
      <input type="text" id="form-name" placeholder="John Smith" />
    </div>
    
    <div class="form-group">
      <label>Postcode *</label>
      <input type="text" id="form-postcode" placeholder="SG12 9AB" />
    </div>
    
    <div class="form-group">
      <label>Phone Number *</label>
      <input type="tel" id="form-phone" placeholder="01920 468674" />
    </div>
    
    <div class="form-group">
      <label>Email Address</label>
      <input type="email" id="form-email" placeholder="john@example.com" />
    </div>
    
    <div class="form-group">
      <label>How can we help?</label>
      <textarea id="form-message" rows="3" placeholder="Tell us what you need..."></textarea>
    </div>
    
    <button class="submit-btn" onclick="submitContactForm()">
      <i class="fas fa-paper-plane"></i> Send Request
    </button>
    
    <p style="font-size:0.75rem;color:#666;margin-top:12px;text-align:center;">
      ğŸ”’ Your information is secure and will never be shared.
    </p>
  </div>`;
}

function showBookingForm(type) {
  const typeMessages = {
    service: 'book a boiler service',
    quote: 'get a quote',
    repair: 'book a repair',
    certificate: 'book a gas safety certificate'
  };
  
  addMsg(`I'd like to ${typeMessages[type] || 'get in touch'}`, false);
  setTimeout(() => {
    addMsg(showContactForm(), true);
  }, 800);
}

function quickCall() {
  addMsg("I'd like to call you", false);
  setTimeout(() => {
    addMsg(`Great! You can reach us on:\n\n<div class="price-box">ğŸ“ <strong>01920 468674</strong><br>or<br>ğŸ“± <strong>07971252440</strong></div>\n\nWe're always happy to chat!`, true);
  }, 800);
}

async function submitContactForm() {
  const name = document.getElementById('form-name')?.value.trim();
  const postcode = document.getElementById('form-postcode')?.value.trim();
  const phone = document.getElementById('form-phone')?.value.trim();
  const email = document.getElementById('form-email')?.value.trim();
  const message = document.getElementById('form-message')?.value.trim();
  
  if (!name || !postcode || !phone) {
    addMsg("âš ï¸ Please fill in all required fields (Name, Postcode, Phone)", true);
    return;
  }
  
  // Show sending message
  const submitBtn = document.querySelector('.submit-btn');
  const originalText = submitBtn.innerHTML;
  submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Sending...';
  submitBtn.disabled = true;
  
  try {
    // Send email using EmailJS
    const response = await fetch('https://api.emailjs.com/api/v1.0/email/send', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({
        service_id: 'service_wrights_gas',
        template_id: 'template_flamey_lead',
        user_id: 'YOUR_EMAILJS_PUBLIC_KEY', // You'll need to replace this
        template_params: {
          to_email: 'contact@wrightsgas.co.uk',
          from_name: name,
          customer_name: name,
          customer_phone: phone,
          customer_postcode: postcode,
          customer_email: email || 'Not provided',
          customer_message: message || 'No message provided',
          timestamp: new Date().toLocaleString('en-GB', { 
            dateStyle: 'full', 
            timeStyle: 'short' 
          })
        }
      })
    });
    
    if (response.ok) {
      addMsg(`<strong>âœ… Thank you, ${name}!</strong>\n\nYour request has been sent to our team. We'll contact you shortly at ${phone}.\n\n<div class="info-box">ğŸ“ Need to speak to us sooner? Call <strong>01920 468674</strong></div>`, true);
    } else {
      throw new Error('Email send failed');
    }
  } catch (error) {
    console.error('Form submission error:', error);
    
    // Fallback message
    addMsg(`<strong>âš ï¸ Almost there, ${name}!</strong>\n\nPlease call us directly to complete your booking:\n\n<div class="price-box">ğŸ“ <strong>01920 468674</strong><br>or<br>ğŸ“± <strong>07971252440</strong></div>\n\nMention:\nâ€¢ Name: ${name}\nâ€¢ Postcode: ${postcode}\nâ€¢ Phone: ${phone}`, true);
  } finally {
    if (submitBtn) {
      submitBtn.innerHTML = originalText;
      submitBtn.disabled = false;
    }
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MESSAGE HANDLING
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function addMsg(text, fromBot = true) {
  const messagesDiv = document.getElementById('messages');
  const div = document.createElement('div');
  div.className = fromBot ? 'bot' : 'user';
  
  if (fromBot) {
    div.innerHTML = `
      <div class="avatar" style="width:42px;height:42px;">${flamey}</div>
      <div class="bot-bubble">${text}</div>
    `;
  } else {
    div.innerHTML = `<div class="user">${text.replace(/\n/g, '<br>')}</div>`;
  }
  
  messagesDiv.appendChild(div);
  div.scrollIntoView({behavior: 'smooth', block: 'end'});
}

function showTypingIndicator() {
  const messagesDiv = document.getElementById('messages');
  const typingDiv = document.createElement('div');
  typingDiv.className = 'bot';
  typingDiv.id = 'typing-indicator';
  typingDiv.innerHTML = `
    <div class="avatar" style="width:42px;height:42px;">${flamey}</div>
    <div class="bot-bubble">
      <div class="typing-indicator">
        <span></span><span></span><span></span>
      </div>
    </div>
  `;
  messagesDiv.appendChild(typingDiv);
  typingDiv.scrollIntoView({behavior: 'smooth', block: 'end'});
}

function removeTypingIndicator() {
  const indicator = document.getElementById('typing-indicator');
  if (indicator) indicator.remove();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// USER INPUT HANDLING
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function send() {
  const input = document.getElementById('user-input');
  const text = input.value.trim();
  if (!text) return;

  addMsg(text, false);
  input.value = '';
  
  const sendBtn = document.getElementById('send-btn');
  sendBtn.disabled = true;
  input.disabled = true;
  
  showTypingIndicator();
  
  await new Promise(resolve => setTimeout(resolve, 600 + Math.random() * 800));
  
  const intent = analyzeIntent(text);
  const response = generateResponse(intent, text);
  
  removeTypingIndicator();
  addMsg(response, true);
  
  sendBtn.disabled = false;
  input.disabled = false;
  input.focus();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// QUICK BUTTONS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function quick(type) {
  const questions = {
    'prices': 'What are your prices?',
    'boiler-service': 'How much is a boiler service?',
    'installation': 'Tell me about boiler installation',
    'areas': 'What areas do you cover?',
    'water-softener': 'Tell me about water softeners',
    'services': 'What services do you offer?',
    'repairs': 'I need a boiler repair'
  };
  
  document.getElementById('user-input').value = questions[type] || '';
  send();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CHAT UI - ALWAYS VISIBLE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Show greeting message on page load
window.addEventListener('DOMContentLoaded', function() {
  setTimeout(() => {
    addMsg(generateResponse({ intent: 'greeting' }, ''), true);
  }, 500);
});

document.getElementById('user-input').onkeypress = (e) => {
  if (e.key === 'Enter') send();
};
document.getElementById('send-btn').onclick = send;

console.log('ğŸ”¥ Flamey AI Chatbot initialized with web knowledge!');
console.log('Knowledge base loaded from www.wrightsgas.co.uk');
</script>

</body>
</html>
